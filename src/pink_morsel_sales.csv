import pandas as pd
import os
import glob

def process_morsel_data(input_folder='data', output_file='pink_morsel_sales.csv'):
    """
    Process Soul Foods morsel data:
    1. Read all CSV files from input folder
    2. Filter for Pink Morsels only
    3. Calculate sales (quantity * price)
    4. Keep only sales, date, and region columns
    5. Save to output file
    """
    # Get all CSV files in the data folder
    csv_files = glob.glob(os.path.join(input_folder, '*.csv'))
    
    # Create empty list to store dataframes
    dfs = []
    
    # Read each CSV file and append to list
    for file in csv_files:
        df = pd.read_csv(file)
        dfs.append(df)
    
    # Combine all dataframes
    combined_df = pd.concat(dfs, ignore_index=True)
    
    # Filter for Pink Morsels only
    pink_morsels_df = combined_df[combined_df['product'] == 'pink morsel']
    
    # Calculate sales (quantity * price)
    pink_morsels_df['sales'] = pink_morsels_df['quantity'] * pink_morsels_df['price']
    
    # Keep only sales, date, and region columns
    result_df = pink_morsels_df[['sales', 'date', 'region']]
    
    # Save to output file
    result_df.to_csv(output_file, index=False)
    
    print(f"Processed {len(combined_df)} total records")
    print(f"Found {len(pink_morsels_df)} Pink Morsel records")
    print(f"Output saved to {output_file}")
    
    return result_df

# Execute the function when script is run directly
if __name__ == "__main__":
    process_morsel_data()